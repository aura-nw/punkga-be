- name: allowed-queries
  definition:
    queries:
      - name: Admin - Deactive Creator By PK
        query: |
          mutation DeactiveCreatorByPk ($id: Int = 10) {
            update_creators_by_pk(pk_columns: {id:$id}, _set: {isActive:false}) {
              id
              name
              isActive
            }
          }
      - name: Admin - Update creator by pk
        query: |
          mutation UpdateCreator ($id: Int = 10, $name: String = "", $bio: String = "", $socials: jsonb = "") {
            update_creators_by_pk(pk_columns: {id:$id}, _set: {name:$name,bio:$bio,socials:$socials}) {
              id
              name
              bio
              socials
              updated_at
            }
          }
      - name: Admin - Deactive Manga
        query: |
          mutation DeactiveManga ($id: Int = 10) {
            update_manga_by_pk(pk_columns: {id:$id}, _set: {status:"Removed"}) {
              id
              status
              updated_at
            }
          }
      - name: Admin - Update manga status
        query: |
          mutation UpdateMangaStatus ($id: Int! = 10, $status: String! = "") {
            update_manga_by_pk(pk_columns: {id:$id}, _set: {status:$status}) {
              id
              updated_at
              status
            }
          }
      - name: Admin - Delete chapter
        query: |
          mutation DeleteChapter ($manga_id: Int = 10, $chapter_number: Int = 10) {
            delete_chapter_languages(where: {chapter:{_and:{manga_id:{_eq:$manga_id},chapter_number:{_eq:$chapter_number}}}}) {
              affected_rows
            }
            delete_chapters(where: {_and:{manga_id:{_eq:$manga_id},chapter_number:{_eq:$chapter_number}}}) {
              affected_rows
            }
          }
      - name: Admin - Create Manga Creators
        query: |
          mutation CreateMangaCreators ($manga_creators: [manga_creator_insert_input!] = [{creator_id:10,manga_id:10}]) {
            insert_manga_creator(objects: $manga_creators) {
              affected_rows
            }
          }
      - name: Admin - Delete manga creators
        query: |
          mutation DeleteMangaCreators ($manga_id: Int = 10, $creator_ids: [Int!] = [10]) {
            delete_manga_creator(where: {_and:{manga_id:{_eq:$manga_id},creator_id:{_in:$creator_ids}}}) {
              affected_rows
            }
          }
      - name: Admin - Create manga languages
        query: |
          mutation InsertMangaLanguages ($manga_languages: [manga_languages_insert_input!] = {manga_id:10,language_id:10,is_main_language:false,title:"",description:""}) {
            insert_manga_languages(objects: $manga_languages) {
              affected_rows
            }
          }
      - name: Admin - Delete Manga Languages By Manga Id
        query: |
          mutation DeleteMangaLanguagesByMangaId ($manga_id: Int = 10, $language_ids: [Int!] = [10]) {
            delete_manga_languages(where: {_and:{manga_id:{_eq:$manga_id},language_id:{_in:$language_ids}}}) {
              affected_rows
            }
          }
      - name: Admin - Delete manga tags
        query: |
          mutation DeleteMangaTags ($manga_id: Int = 10, $tag_ids: [Int!] = [10]) {
            delete_manga_tag(where: {_and:{manga_id:{_eq:$manga_id},tag_id:{_in:$tag_ids}}}) {
              affected_rows
            }
          }
      - name: Admin - Get All Users
        query: |
          query GetAllUsers {
            authorizer_users(order_by: {updated_at:desc}) {
              id
              nickname
              email
              created_at
              updated_at
            }
          }
      - name: User - Subscribe manga
        query: |
          mutation UserSubscribeManga ($manga_id: Int = 10) {
            insert_subscribers_one(object: {manga_id:$manga_id}) {
              id
              user_id
              manga_id
              created_at
            }
          }
      - name: User - Unsubscribe manga
        query: |
          mutation UserUnsubscribeManga ($manga_id: Int = 10) {
            delete_subscribers(where: {manga_id:{_eq:$manga_id}}) {
              affected_rows
            }
          }
      - name: Admin - Create Tag
        query: |
          mutation CreateTag ($tag_languages: [tag_languages_insert_input!] = [{language_id:1,value:""}]) {
            insert_tags(objects: {tag_languages:{data:$tag_languages}}) {
              affected_rows
              returning {
                id
                created_at
                tag_languages {
                  id
                  value
                  tag_id
                  language_id
                }
              }
            }
          }
      - name: Admin - Create manga tags
        query: |
          mutation AddMangaTag ($manga_tags: [manga_tag_insert_input!] = [{manga_id:10,tag_id:10}]) {
            insert_manga_tag(objects: $manga_tags) {
              affected_rows
              returning {
                manga {
                  id
                  status
                }
                tag {
                  id
                  tag_languages {
                    tag_id
                    language_id
                    value
                  }
                }
              }
            }
          }
      - name: Delete tag
        query: |
          mutation DeleteTag ($id: Int = 10) {
            delete_tag_languages(where: {tag_id:{_eq:$id}}) {
              affected_rows
            }
            delete_tags(where: {id:{_eq:$id}}) {
              affected_rows
            }
          }
      - name: Admin - Delete chapter languages
        query: |
          mutation DeleteChapterLanguague ($chapter_id: Int = 10, $language_ids: [Int!] = [1]) {
            delete_chapter_languages(where: {_and:{chapter_id:{_eq:$chapter_id},language_id:{_in:$language_ids}}}) {
              affected_rows
            }
          }
      - name: Admin - Update chapter language
        query: |
          mutation UpdateChapterLanguague ($chapter_id: Int!, $language_id: Int!, $detail: jsonb! = "") {
            update_chapter_languages(where: {_and:{chapter_id:{_eq:$chapter_id},language_id:{_eq:$language_id}}}, _set: {detail:$detail}) {
              affected_rows
            }
          }
      - name: Admin - Create Chapter
        query: |
          mutation AddChapter ($manga_id: Int = 10, $chapter_name: String = "", $chapter_number: Int = 10, $chapter_type: String = "", $thumbnail_url: String = "", $pushlish_date: date, $chapter_languages: [chapter_languages_insert_input!] = {language_id:10,detail:""}) {
            insert_chapters_one(object: {chapter_name:$chapter_name,chapter_number:$chapter_number,chapter_type:$chapter_type,thumbnail_url:$thumbnail_url,manga_id:$manga_id,status:"CREATED",pushlish_date:$pushlish_date,chapter_languages:{data:$chapter_languages}}) {
              id
              chapter_name
              chapter_number
              pushlish_date
              status
              created_at
            }
          }
      - name: Admin - Update tag languages many
        query: |
          mutation UpdateTagLanguages ($updates: [tag_languages_updates!] = {where:{id:{_eq:1}},_set:{value:""}}) {
            update_tag_languages_many(updates: $updates) {
              affected_rows
            }
          }
      - name: Public - Query all tags
        query: |
          query QueryTags {
            tags(order_by: {id:desc}) {
              id
              created_at
              tag_languages {
                id
                tag_id
                language_id
                value
              }
            }
          }
      - name: Admin - Create Manga
        query: |
          mutation CreateNewManga ($status: String = "", $banner: String = "", $poster: String = "", $manga_languages: [manga_languages_insert_input!] = {language_id:10,is_main_language:false,description:"",title:""}, $manga_creators: [manga_creator_insert_input!] = {creator_id:10}, $manga_tags: [manga_tag_insert_input!] = {tag_id:10}) {
            insert_manga_one(object: {status:$status,manga_creators:{data:$manga_creators},banner:$banner,poster:$poster,manga_languages:{data:$manga_languages},manga_tags:{data:$manga_tags}}) {
              id
              created_at
              status
            }
          }
      - name: Public - Query all languages
        query: |
          query QueryAllLanguages {
            languages {
              id
              symbol
              description
              icon
              is_main
            }
          }
      - name: Admin - Query all tags by main language
        query: |
          query QueryTagsByMainLanguage ($main_language_id: Int = 1) {
            tags(order_by: {id:desc}) {
              id
              created_at
              tag_languages(where: {language_id:{_eq:$main_language_id}}) {
                id
                tag_id
                language_id
                value
              }
            }
          }
      - name: Public - Query tag by ID
        query: |
          query QueryTagById ($id: Int = 10) {
            tags_by_pk(id: $id) {
              id
              tag_languages {
                id
                tag_id
                language_id
                value
                tag_languages_language {
                  description
                }
              }
            }
          }
      - name: User - Unlike chapter
        query: |
          mutation UserUnLikeChapter ($chapter_id: Int!) {
            delete_likes(where: {chapter_id:{_eq:$chapter_id}}) {
              affected_rows
            }
          }
      - name: User - Like chapter
        query: |
          mutation UserLikeChapter ($chapter_id: Int!) {
            insert_likes_one(object: {chapter_id:$chapter_id}) {
              id
              user_id
              chapter_id
              created_at
            }
          }
      - name: User - Add comment in chapter
        query: |
          mutation AddUserComment ($chapter_id: Int = 21, $ref_activity: Int, $content: String = "") {
            insert_social_activities_one(object: {chapter_id:$chapter_id,content:$content,ref_activity:$ref_activity}) {
              id
              content
              user_id
              ref_activity
            }
          }
      - name: Admin - Update chapter
        query: |
          mutation UpdateChapterByPK ($id: Int!, $chapter_name: String, $chapter_number: Int, $chapter_type: String, $thumbnail_url: String, $status: String = "", $pushlish_date: timestamptz = "") {
            update_chapters_by_pk(pk_columns: {id:$id}, _set: {chapter_name:$chapter_name,chapter_type:$chapter_type,thumbnail_url:$thumbnail_url,chapter_number:$chapter_number,status:$status,pushlish_date:$pushlish_date}) {
              id
              chapter_name
              chapter_number
              chapter_type
              thumbnail_url
              updated_at
              manga_id
            }
          }
      - name: Admin - Update tag by ID
        query: |
          mutation UpdateTag ($tag_id: Int! = 10, $tag_languages: [tag_languages_insert_input!] = {language_id:1,value:""}) {
            delete_tag_languages(where: {tag_id:{_eq:$tag_id}}) {
              affected_rows
            }
            insert_tags(objects: {id:$tag_id,tag_languages:{data:$tag_languages}}, on_conflict: {constraint:tags_pkey,update_columns:id}) {
              returning {
                id
                tag_languages {
                  language_id
                  value
                }
              }
            }
          }
      - name: Admin - Get chapter detail
        query: |
          query GetChapterDetail ($manga_id: Int = 18, $chapter_number: Int = 1) {
            chapters(where: {_and:{chapter_number:{_eq:$chapter_number},manga:{id:{_eq:$manga_id}}}}) {
              id
              chapter_number
              chapter_name
              chapter_type
              thumbnail_url
              status
              pushlish_date
              chapter_languages {
                language_id
                detail
              }
            }
          }
      - name: Admin - Update manga
        query: |
          mutation UpdateManga ($manga_id: Int!, $status: String!, $banner: String!, $poster: String!, $manga_languages: [manga_languages_insert_input!] = {language_id:10,is_main_language:false,description:"",title:""}, $manga_creators: [manga_creator_insert_input!] = {creator_id:10}, $manga_tags: [manga_tag_insert_input!] = {tag_id:10}, $release_date: timestamptz = "") {
            delete_manga_tag(where: {manga_id:{_eq:$manga_id}}) {
              affected_rows
            }
            delete_manga_creator(where: {manga_id:{_eq:$manga_id}}) {
              affected_rows
            }
            delete_manga_languages(where: {manga_id:{_eq:$manga_id}}) {
              affected_rows
            }
            insert_manga_one(object: {status:$status,manga_creators:{data:$manga_creators},banner:$banner,poster:$poster,manga_languages:{data:$manga_languages},manga_tags:{data:$manga_tags},id:$manga_id,release_date:$release_date}, on_conflict: {constraint:manga_pkey,update_columns:[banner,poster,status,release_date]}) {
              id
              banner
              poster
              status
              release_date
              created_at
              status
              manga_creators {
                creator_id
              }
              manga_languages {
                language_id
                title
                is_main_language
                description
              }
              manga_tags {
                tag_id
              }
            }
          }
      - name: Public - Search manga
        query: |
          query SearchManga ($text: String = "%%") {
            manga(where: {_and:{_or:[{manga_languages:{title:{_ilike:$text}}},{manga_creators:{creator:{name:{_ilike:$text}}}}],status:{_neq:"Removed"}}}, limit: 20) {
              id
              manga_creators {
                creator {
                  id
                  name
                  isActive
                }
              }
              status
              chapters(limit: 1, order_by: {updated_at:desc}, where: {status:{_eq:"Published"}}) {
                id
                chapter_number
                updated_at
              }
              manga_tags(limit: 5) {
                tag {
                  id
                  tag_languages {
                    language_id
                    tag_id
                    value
                  }
                }
              }
              manga_languages {
                title
                description
                is_main_language
                language_id
              }
              banner
              poster
              manga_total_likes {
                likes
              }
              manga_total_views {
                views
              }
            }
          }
      - name: Public - Get chapter detail
        query: |
          query GetChapterReadingDetail ($manga_id: Int = 18, $chapter_number: Int = 1, $user_id: bpchar = "") {
            chapters(where: {_and:{chapter_number:{_eq:$chapter_number},manga:{_and:{id:{_eq:$manga_id},_or:[{status:{_ilike:"On-going"}},{status:{_eq:"Finished"}}]}}}}) {
              id
              chapter_number
              chapter_name
              chapter_type
              thumbnail_url
              status
              pushlish_date
              chapter_languages(where: {chapter:{status:{_eq:"Published"}}}) {
                language_id
                detail
              }
              comments: social_activities_aggregate {
                aggregate {
                  count
                }
              }
              views
              chapters_likes_aggregate {
                aggregate {
                  count
                }
              }
              chapters_likes(where: {user_id:{_eq:$user_id}}) {
                id
                created_at
                user_id
                chapter_id
              }
            }
          }
      - name: Public - Query latest update manga
        query: |
          query GetLatestUpdatedManga {
            manga(order_by: {latest_published:desc_nulls_last}, where: {status:{_neq:"Removed"}}) {
              id
              latest_published
              manga_total_views {
                views
              }
              manga_total_likes {
                likes
              }
              manga_creators {
                creator {
                  id
                  name
                  isActive
                }
              }
              status
              chapters(limit: 1, order_by: {chapter_number:desc}, where: {status:{_eq:"Published"}}) {
                id
                chapter_number
                pushlish_date
                status
                updated_at
              }
              manga_tags(limit: 5) {
                tag {
                  id
                  tag_languages {
                    language_id
                    tag_id
                    value
                  }
                }
              }
              manga_languages {
                title
                description
                is_main_language
                language_id
              }
              banner
              poster
            }
          }
      - name: Public - Get subscribe list
        query: |
          query GetSubscribeList ($user_id: bpchar = "") {
            subscribers(order_by: {created_at:desc}, where: {_and:{user_id:{_eq:$user_id},subscribers_manga:{status:{_neq:"Removed"}}}}) {
              subscribers_manga {
                id
                banner
                poster
                status
                nearest_upcoming
                manga_languages {
                  is_main_language
                  language_id
                  title
                }
                manga_creators {
                  creator {
                    id
                    name
                    isActive
                  }
                }
                chapters(order_by: {chapter_number:desc_nulls_last}, limit: 1, where: {status:{_eq:"Published"}}) {
                  chapter_number
                  id
                  pushlish_date
                }
                manga_total_views {
                  views
                }
                manga_total_likes {
                  likes
                }
                manga_tags(limit: 5) {
                  tag {
                    id
                    tag_languages {
                      language_id
                      value
                    }
                  }
                }
              }
              user_id
            }
          }
      - name: Public - Get manga list by list id
        query: |
          query GetListMangaById ($id: [Int!]) {
            manga(where: {_and:{id:{_in:$id},status:{_neq:"Removed"}}}) {
              id
              banner
              poster
              status
              nearest_upcoming
              manga_languages {
                is_main_language
                language_id
                title
              }
              manga_creators {
                creator {
                  id
                  name
                  isActive
                }
              }
              chapters(order_by: {chapter_number:desc_nulls_last}, limit: 1, where: {status:{_eq:"Published"}}) {
                chapter_number
                id
                pushlish_date
              }
              manga_total_views {
                views
              }
              manga_total_likes {
                likes
              }
              manga_tags(limit: 5) {
                tag {
                  id
                  tag_languages {
                    language_id
                    value
                  }
                }
              }
            }
          }
      - name: Public - Get Chapter Comments
        query: |
          query GetChapterComments ($chapter_id: Int!) {
            social_activities(where: {_and:{ref_activity:{_is_null:true},chapter_id:{_eq:$chapter_id}}}, order_by: {created_at:desc}) {
              id
              social_activities_authorizer_user {
                id
                nickname
                picture
              }
              content
              created_at
              replies: social_activities(order_by: {created_at:asc}) {
                social_activities_authorizer_user {
                  id
                  nickname
                  picture
                }
                content
                created_at
              }
            }
          }
      - name: Admin - Query List Manga
        query: |
          query QueryListManga {
            manga(order_by: {created_at:desc}) {
              id
              banner
              poster
              status
              release_date
              publish_date
              created_at
              manga_creators {
                creator {
                  name
                }
              }
              chapters_aggregate {
                aggregate {
                  count
                  max {
                    chapter_number
                  }
                }
              }
              manga_languages {
                id
                title
                language_id
                is_main_language
              }
            }
          }
      - name: Public - Get trending manga
        query: |
          query GetTrendingManga {
            manga(order_by: {manga_total_views:{views:desc_nulls_last}}, limit: 4, where: {status:{_neq:"Removed"}}) {
              id
              chapters(limit: 1, order_by: {chapter_number:desc}, where: {status:{_eq:"Published"}}) {
                id
                chapter_number
                updated_at
              }
              manga_total_likes {
                likes
              }
              manga_total_views {
                views
              }
              manga_tags(limit: 5) {
                tag {
                  id
                  tag_languages {
                    language_id
                    tag_id
                    value
                  }
                }
              }
              manga_languages {
                title
                language_id
                is_main_language
                description
              }
              banner
              poster
              status
              manga_creators {
                creator {
                  name
                  id
                  isActive
                }
              }
            }
          }
      - name: User - Set address
        query: |
          mutation SetUserWalletAddress ($wallet_address: String!) {
            update_authorizer_users(where: {wallet_address:{_is_null:true}}, _set: {wallet_address:$wallet_address}) {
              returning {
                id
                wallet_address
              }
              affected_rows
            }
          }
      - name: User - Get Profile
        query: |
          query GetUserProfile {
            authorizer_users {
              id
              email
              email_verified_at
              bio
              birthdate
              gender
              wallet_address
              nickname
              picture
              signup_methods
            }
          }
      - name: Admin - Delete User
        query: |
          mutation DeleteUser ($id: bpchar!) {
            delete_authorizer_sessions(where: {id:{_eq:$id}}) {
              affected_rows
            }
            delete_likes(where: {user_id:{_eq:$id}}) {
              affected_rows
            }
            delete_subscribers(where: {user_id:{_eq:$id}}) {
              affected_rows
            }
            update_social_activities(where: {user_id:{_eq:$id}}, _set: {user_id:null,content:""}) {
              affected_rows
            }
            delete_authorizer_users(where: {id:{_eq:$id}}) {
              affected_rows
            }
          }
      - name: Public - Get manga detail
        query: |
          query GetMangaReadingDetail ($id: Int = 1, $user_id: bpchar = "") {
            manga(where: {_and:{id:{_eq:$id},status:{_neq:"Removed"}}}) {
              id
              poster
              banner
              status
              release_date
              manga_creators {
                creator {
                  id
                  name
                  isActive
                }
              }
              manga_total_likes {
                likes
              }
              manga_total_views {
                views
              }
              manga_languages {
                title
                description
                is_main_language
                language_id
              }
              chapters_aggregate {
                aggregate {
                  count
                }
              }
              chapters(order_by: {chapter_number:desc_nulls_last}, where: {status:{_neq:"Inactive"}}) {
                id
                chapter_number
                chapter_name
                chapter_type
                thumbnail_url
                pushlish_date
                status
                views
                chapter_total_likes {
                  likes
                }
                chapters_likes(where: {user_id:{_eq:$user_id}}) {
                  id
                  created_at
                }
              }
              manga_subscribers_aggregate {
                aggregate {
                  count
                }
              }
              manga_tags(limit: 5) {
                tag {
                  id
                  tag_languages {
                    language_id
                    value
                  }
                }
              }
              manga_subscribers(where: {user_id:{_eq:$user_id}}) {
                id
                created_at
              }
            }
          }
      - name: Admin - Query creators
        query: |
          query QueryCreators {
            creators(order_by: {created_at:desc}) {
              id
              name
              total_subscribers
              manga_creators_aggregate {
                aggregate {
                  count
                }
              }
              created_at
              socials
              isActive
              bio
              avatar_url
              dob
              gender
              pen_name
            }
          }
      - name: Admin - Add creator
        query: |
          mutation AddCreator ($name: String, $bio: String, $socials: jsonb = null, $pen_name: String = "", $profile_picture: String = "", $gender: String = "", $dob: String = "", $avatar_url: String = "") {
            insert_creators_one(object: {name:$name,bio:$bio,socials:$socials,pen_name:$pen_name,gender:$gender,dob:$dob,avatar_url:$avatar_url}) {
              id
              name
              socials
              created_at
              bio
            }
          }
      - name: Admin - Get manga detail
        query: |
          query GetMangaReadingDetail ($id: Int = 1) {
            manga_by_pk(id: $id) {
              id
              poster
              banner
              status
              contract_addresses
              publish_date
              release_date
              created_at
              manga_languages {
                title
                description
                is_main_language
                language_id
              }
              chapters_aggregate {
                aggregate {
                  sum {
                    views
                    likes
                  }
                  count
                }
              }
              manga_subscribers_aggregate {
                aggregate {
                  count
                }
              }
              manga_tags {
                tag {
                  tag_languages {
                    tag_id
                    language_id
                    value
                  }
                }
              }
              chapters(order_by: {chapter_number:desc_nulls_last}) {
                id
                chapter_number
                chapter_name
                chapter_type
                thumbnail_url
                pushlish_date
                status
              }
              manga_creators {
                creator {
                  id
                  name
                }
              }
            }
          }
      - name: Public - Query creator by id
        query: |
          query QueryCreatorById ($id: Int!) {
            creators(where: {id:{_eq:$id}}) {
              id
              avatar_url
              bio
              dob
              gender
              name
              pen_name
              socials
              total_subscribers
              isActive
              created_at
            }
          }
